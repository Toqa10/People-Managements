# -*- coding: utf-8 -*-
"""HR.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BRPDra8Zdc_vshxER2aey6dnJ-HG5b7a
"""
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import io

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³ØªØ§ÙŠÙ„
st.set_page_config(page_title="HR Analytics Dashboard", layout="wide")
st.markdown("<h1 style='text-align: center;'>ğŸ“Š HR Analytics Dashboard</h1>", unsafe_allow_html=True)
st.markdown("---")

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
@st.cache_data
def load_data():
    employees = pd.read_csv("employee.csv")
    salaries = pd.read_csv("salary.csv")
    departments = pd.read_csv("department.csv")
    titles = pd.read_csv("title.csv")
    return employees, salaries, departments, titles

employees, salaries, departments, titles = load_data()

# Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
data = employees.merge(salaries, on="emp_no").merge(departments, on="emp_no").merge(titles, on="emp_no")

# Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø§Ø±Øª ÙƒØµÙˆØ±Ø©
def download_chart(fig, filename):
    buf = io.BytesIO()
    fig.savefig(buf, format="png", bbox_inches="tight")
    st.download_button("ğŸ“¥ Download Chart", data=buf.getvalue(), file_name=filename, mime="image/png")

# Ø§Ù„Ø´Ø§Ø±Øª 1: Ø£Ø¹Ù„Ù‰ Ø±Ø§ØªØ¨ ÙÙŠ ÙƒÙ„ Ù‚Ø³Ù…
st.subheader("ğŸ’° Highest Salary Found Per Department")
fig1, ax1 = plt.subplots()
highest_salary = data.groupby('dept_name')['salary'].max().sort_values(ascending=False)
sns.barplot(x=highest_salary.values, y=highest_salary.index, ax=ax1, palette="viridis")
ax1.set_xlabel("Highest Salary")
st.pyplot(fig1)
st.markdown("*This chart shows the maximum salary found in each department.*")
download_chart(fig1, "highest_salary_per_department.png")

# Ø§Ù„Ø´Ø§Ø±Øª 2: ØªØ·ÙˆØ± Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù†
st.subheader("ğŸ“ˆ Average Annual Salary Growth Over Time")
fig2, ax2 = plt.subplots()
salaries['from_date'] = pd.to_datetime(salaries['from_date'])
salaries['year'] = salaries['from_date'].dt.year
avg_growth = salaries.groupby('year')['salary'].mean()
sns.lineplot(x=avg_growth.index, y=avg_growth.values, marker='o', ax=ax2)
ax2.set_ylabel("Average Salary")
st.pyplot(fig2)
st.markdown("*This chart displays how average salaries changed over the years.*")
download_chart(fig2, "average_salary_growth.png")

# Ø§Ù„Ø´Ø§Ø±Øª 3: Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
st.subheader("ğŸ‘« Average Salary by Gender")
fig3, ax3 = plt.subplots()
avg_gender_salary = data.groupby("gender")["salary"].mean()
sns.barplot(x=avg_gender_salary.index, y=avg_gender_salary.values, palette="pastel", ax=ax3)
ax3.set_ylabel("Average Salary")
st.pyplot(fig3)
st.markdown("*This chart compares average salaries between genders.*")
download_chart(fig3, "salary_by_gender.png")

# Ø§Ù„Ø´Ø§Ø±Øª 4: Ø¹Ø¯Ø¯ Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ø±Ø§ØªØ¨
st.subheader("ğŸ“Š Employee Tenure vs. Latest Salary")
fig4, ax4 = plt.subplots()
data['hire_date'] = pd.to_datetime(data['hire_date'])
data['tenure'] = 2025 - data['hire_date'].dt.year
sns.scatterplot(data=data, x='tenure', y='salary', hue='gender', ax=ax4)
st.pyplot(fig4)
st.markdown("*This chart explores the relationship between tenure and salary.*")
download_chart(fig4, "tenure_vs_salary.png")

# Ø§Ù„Ø´Ø§Ø±Øª 5: Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ ÙƒÙ„ Ù‚Ø³Ù…
st.subheader("ğŸ“‰ Average Employee Tenure by Department")
fig5, ax5 = plt.subplots()
avg_tenure = data.groupby('dept_name')['tenure'].mean().sort_values()
sns.barplot(x=avg_tenure.values, y=avg_tenure.index, ax=ax5, palette="coolwarm")
ax5.set_xlabel("Average Tenure (Years)")
st.pyplot(fig5)
st.markdown("*This chart shows the average employee tenure per department.*")
download_chart(fig5, "avg_tenure_department.png")

# Ø§Ù„Ø´Ø§Ø±Øª 6: Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ù„ÙƒÙ„ Ù‚Ø³Ù…
st.subheader("ğŸ’° Total Salary Paid per Department")
fig6, ax6 = plt.subplots()
total_salary = data.groupby("dept_name")["salary"].sum().sort_values()
sns.barplot(x=total_salary.values, y=total_salary.index, palette="flare", ax=ax6)
ax6.set_xlabel("Total Salary")
st.pyplot(fig6)
st.markdown("*This chart displays total salary payouts by department.*")
download_chart(fig6, "total_salary_department.png")

# Ø§Ù„Ø´Ø§Ø±Øª 7: ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
st.subheader("ğŸ‘¥ Employee Count by Latest Title & Gender")
fig7, ax7 = plt.subplots(figsize=(10, 6))
sns.countplot(data=data, y="title", hue="gender", ax=ax7)
st.pyplot(fig7)
st.markdown("*This chart shows the job title distribution by gender.*")
download_chart(fig7, "title_by_gender.png")

# Ø§Ù„Ø´Ø§Ø±Øª 8: Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ø¨Ø± Ø§Ù„Ø³Ù†ÙˆØ§Øª
st.subheader("ğŸ“ˆ Hiring Trend Over Time")
fig8, ax8 = plt.subplots()
data['hire_year'] = data['hire_date'].dt.year
hire_trend = data['hire_year'].value_counts().sort_index()
sns.lineplot(x=hire_trend.index, y=hire_trend.values, marker="o", ax=ax8)
ax8.set_ylabel("Number of Hires")
st.pyplot(fig8)
st.markdown("*This chart shows how many employees were hired each year.*")
download_chart(fig8, "hiring_trend.png")

# Ø§Ù„Ø´Ø§Ø±Øª 9: Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨ÙŠÙ† Ø§Ù„Ø°ÙƒÙˆØ± ÙˆØ§Ù„Ø¥Ù†Ø§Ø« ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
st.subheader("ğŸ’¸ Average Salary by Gender per Department")
fig9, ax9 = plt.subplots(figsize=(10, 6))
avg_gender_dept = data.groupby(["dept_name", "gender"])["salary"].mean().reset_index()
sns.barplot(data=avg_gender_dept, x="salary", y="dept_name", hue="gender", ax=ax9)
st.pyplot(fig9)
st.markdown("*This chart compares gender-based salary gaps per department.*")
download_chart(fig9, "gender_salary_gap_by_dept.png")

# Ø§Ù„Ø´Ø§Ø±Øª 10: Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø±
st.subheader("ğŸ“Š Average Age vs. Number of Promotions")
fig10, ax10 = plt.subplots()
data['birth_date'] = pd.to_datetime(data['birth_date'])
data['age'] = 2025 - data['birth_date'].dt.year
prom_age = data.groupby('age')['no_of_promotions'].mean()
sns.lineplot(x=prom_age.index, y=prom_age.values, ax=ax10)
ax10.set_ylabel("Average Promotions")
st.pyplot(fig10)
st.markdown("*This chart shows the relationship between age and promotion frequency.*")
download_chart(fig10, "promotions_by_age.png")

# Ø§Ù„Ø´Ø§Ø±Øª 11: Ø£Ù‚Ø³Ø§Ù… Ø¨Ù‡Ø§ Ø®Ø·Ø± Ø§Ø³ØªÙ‚Ø§Ù„Ø© Ø¹Ø§Ù„ÙŠ
st.subheader("ğŸ”¥ Average Attrition Risk Score per Department")
if "attrition_risk" in data.columns:
    fig11, ax11 = plt.subplots()
    avg_risk = data.groupby("dept_name")["attrition_risk"].mean().sort_values(ascending=False)
    sns.barplot(x=avg_risk.values, y=avg_risk.index, palette="Reds", ax=ax11)
    ax11.set_xlabel("Risk Score")
    st.pyplot(fig11)
    st.markdown("*This chart shows departments with the highest attrition risk.*")
    download_chart(fig11, "attrition_risk.png")
else:
    st.warning("âš ï¸ 'attrition_risk' column not found in dataset.")

---

Ù‡Ù„ ØªØ­Ø¨ÙŠ ÙƒÙ…Ø§Ù† Ù†Ø³Ø®Ø© ÙÙŠÙ‡Ø§ Ø²Ø± ÙŠØ±Ø¬Ø¹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø£Ùˆ ÙŠØ¹Ù…Ù„ ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…ØŸ
