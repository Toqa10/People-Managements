# -*- coding: utf-8 -*-
"""HR.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BRPDra8Zdc_vshxER2aey6dnJ-HG5b7a
"""

# Commented out IPython magic to ensure Python compatibility.
# import streamlit as st
# import pandas as pd
# import joblib
# 
# # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø¨
# model = joblib.load('risk_model.pkl')
# 
# # Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
# st.title("ğŸ¯ Employee Risk Prediction App")
# 
# st.write("Upload employee data to predict their risk score.")
# 
# # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
# uploaded_file = st.file_uploader("ğŸ“¤ Upload a CSV file", type=["csv"])
# 
# if uploaded_file is not None:
#     data = pd.read_csv(uploaded_file)
#     st.write("âœ… Uploaded Data Preview:")
#     st.write(data.head())
# 
#     # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
#     expected_cols = ['gender', 'title', 'dept_name', 'tenure', 'amount', 'num_promotions']
# 
#     # Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù† ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
#     if all(col in data.columns for col in expected_cols):
#         # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨
#         input_data = data[expected_cols]
# 
#         # Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ±Ù…ÙŠØ² (Ù„Ùˆ Ø¯Ø±Ø¨ØªÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ Ù…Ø±Ù…Ø²Ø© Ù‚ÙˆÙ„ÙŠÙ„ÙŠ)
#         # Ù‡Ù†Ø§ Ø¨Ù†ÙØªØ±Ø¶ Ø§Ù„ØªØ±Ù…ÙŠØ² ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨
# 
#         # Ø§Ù„ØªÙ†Ø¨Ø¤
#         predictions = model.predict(input_data)
# 
#         # Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
#         data['Predicted Risk'] = predictions
#         st.success("âœ… Predictions completed!")
#         st.write(data)
# 
#         # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
#         csv = data.to_csv(index=False)
#         st.download_button("â¬‡ï¸ Download Results as CSV", data=csv, file_name="risk_predictions.csv", mime="text/csv")
#     else:
#         st.error("âŒ Please upload a CSV file with the correct columns: " + ", ".join(expected_cols))
# %%writefile app.py
# import streamlit as st
# import pandas as pd
# import joblib
# 
# df = pd.read_csv("employee.csv")
# 
# model = joblib.load("rf_model.pkl")
# 
# st.title("ğŸš¨ HR Risk Prediction App")
# 
# row = st.selectbox("Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±", df.index)
# 
# if st.button("ØªÙ†Ø¨Ø£"):
#     input_data = df.drop(columns=["risk_score"]).iloc[[row]]
#     prediction = model.predict(input_data)[0]
#     st.success(f"ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: {prediction}")
#
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime

st.set_page_config(page_title="Employee Insights Chat", layout="wide")
st.title("ğŸ’¬ Ask About Employee Data")

# âœ¨ Suggested questions (with buttons)
example_questions = [
    "top salaries",
    "top 10 departments with avg salary",
    "top department",
    "average salary per year",
    "salary growth",
    "most common age group",
    "turnover",
    "tenure vs salary",
    "total salary",
    "salary overall distribution",
    "average salary per title",
    "gender salary",
    "employee distribution by title",
    "department switch"
]

with st.expander("ğŸ’¡ Suggested Questions (Click to autofill)"):
    cols = st.columns(3)
    for i, question in enumerate(example_questions):
        if cols[i % 3].button(question):
            st.session_state["auto_question"] = question

# --- Question input ---
question = st.text_input("â“ Type your question here:", value=st.session_state.get("auto_question", ""))
st.session_state["auto_question"] = ""  # Reset after use

@st.cache_data
def load_data():
    current_emp_snapchat = pd.read_csv("current_employee_snapshot.csv")
    department_employee = pd.read_csv("department_employee.csv")
    employee = pd.read_csv("employee.csv")
    department = pd.read_csv("department.csv")
    salary = pd.read_csv("salary_sample.csv")  # Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØµØºØ±Ø© Ù‡Ù†Ø§
    title = pd.read_csv("title.csv")
    department_manager = pd.read_csv("department_manager.csv")
    return current_emp_snapchat, department_employee, employee, department, salary, title, department_manager

# Load data
current_emp_snapchat, department_employee, employee, department, salary, title, department_manager = load_data()

# âœ‚ï¸ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø²ÙŠ Ù…Ø§ ÙƒØªØ¨ØªÙŠÙ‡ Ø§Ù†ØªÙ Ø¨Ù†ÙØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø´Ø§Ø±ØªØ§Øª ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ if-elif...

# Ø¨Ø¹Ø¯ ÙƒÙ„ Ø´Ø±ÙˆØ· Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ØŒ Ø®Ù„ÙŠÙ‡ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ:

else:
    st.warning("âš ï¸ Your question was not recognized. Try a different phrasing.")

# --- Input for employee ID to show salary trend ---
st.markdown("---")
employee_id_input = st.text_input("ğŸ” Enter employee ID to see salary progression:")

if employee_id_input:
    try:
        emp_id = int(employee_id_input)
        salary['from_date'] = pd.to_datetime(salary['from_date'])
        salary['year'] = salary['from_date'].dt.year
        salary = salary.sort_values(by=['employee_id', 'from_date'])
        salary['salary_growth'] = salary.groupby('employee_id')['amount'].diff()

        emp_salary = salary[salary["employee_id"] == emp_id]

        if not emp_salary.empty:
            st.write(f"ğŸ“ˆ Salary progression for employee ID {emp_id}:")
            st.dataframe(emp_salary[["from_date", "amount", "salary_growth"]])

            fig, ax = plt.subplots()
            ax.plot(emp_salary["from_date"], emp_salary["amount"], marker='o', label='Salary')
            ax.set_title(f'Salary Over Time for Employee {emp_id}')
            ax.set_xlabel('Date')
            ax.set_ylabel('Salary')
            ax.grid(True)
            st.pyplot(fig)
        else:
            st.warning("âŒ No data found for this employee.")
    except ValueError:
        st.warning("âš ï¸ Please enter a valid numeric employee ID.")

        st.warning("Please enter a valid numeric ID.")
