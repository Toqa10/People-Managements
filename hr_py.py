# -*- coding: utf-8 -*-
"""HR.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BRPDra8Zdc_vshxER2aey6dnJ-HG5b7a
"""

# Commented out IPython magic to ensure Python compatibility.
# import streamlit as st
# import pandas as pd
# import joblib
# 
# # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø¨
# model = joblib.load('risk_model.pkl')
# 
# # Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
# st.title("ğŸ¯ Employee Risk Prediction App")
# 
# st.write("Upload employee data to predict their risk score.")
# 
# # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
# uploaded_file = st.file_uploader("ğŸ“¤ Upload a CSV file", type=["csv"])
# 
# if uploaded_file is not None:
#     data = pd.read_csv(uploaded_file)
#     st.write("âœ… Uploaded Data Preview:")
#     st.write(data.head())
# 
#     # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
#     expected_cols = ['gender', 'title', 'dept_name', 'tenure', 'amount', 'num_promotions']
# 
#     # Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù† ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
#     if all(col in data.columns for col in expected_cols):
#         # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨
#         input_data = data[expected_cols]
# 
#         # Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ±Ù…ÙŠØ² (Ù„Ùˆ Ø¯Ø±Ø¨ØªÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ Ù…Ø±Ù…Ø²Ø© Ù‚ÙˆÙ„ÙŠÙ„ÙŠ)
#         # Ù‡Ù†Ø§ Ø¨Ù†ÙØªØ±Ø¶ Ø§Ù„ØªØ±Ù…ÙŠØ² ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨
# 
#         # Ø§Ù„ØªÙ†Ø¨Ø¤
#         predictions = model.predict(input_data)
# 
#         # Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
#         data['Predicted Risk'] = predictions
#         st.success("âœ… Predictions completed!")
#         st.write(data)
# 
#         # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
#         csv = data.to_csv(index=False)
#         st.download_button("â¬‡ï¸ Download Results as CSV", data=csv, file_name="risk_predictions.csv", mime="text/csv")
#     else:
#         st.error("âŒ Please upload a CSV file with the correct columns: " + ", ".join(expected_cols))
# %%writefile app.py
# import streamlit as st
# import pandas as pd
# import joblib
# 
# df = pd.read_csv("employee.csv")
# 
# model = joblib.load("rf_model.pkl")
# 
# st.title("ğŸš¨ HR Risk Prediction App")
# 
# row = st.selectbox("Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±", df.index)
# 
# if st.button("ØªÙ†Ø¨Ø£"):
#     input_data = df.drop(columns=["risk_score"]).iloc[[row]]
#     prediction = model.predict(input_data)[0]
#     st.success(f"ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: {prediction}")
#
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import joblib

st.set_page_config(page_title="Employee Risk & Insights App", layout="wide")
st.title("ğŸ’¼ HR Insights and Risk Prediction")

# Load model
@st.cache_resource
def load_model():
    return joblib.load("risk_model.pkl")

# Load data
@st.cache_data
def load_data():
    current_emp_snapchat = pd.read_csv("current_employee_snapshot.csv")
    department_employee = pd.read_csv("department_employee.csv")
    employee = pd.read_csv("employee.csv")
    department = pd.read_csv("department.csv")
    salary = pd.read_csv("salary.csv")
    title = pd.read_csv("title.csv")
    department_manager = pd.read_csv("department_manager.csv")
    return current_emp_snapchat, department_employee, employee, department, salary, title, department_manager

model = load_model()
current_emp_snapchat, department_employee, employee, department, salary, title, department_manager = load_data()

# --- Risk Prediction Section ---
st.header("ğŸ¯ Upload Employee Data to Predict Risk")
uploaded_file = st.file_uploader("ğŸ“¤ Upload a CSV file", type=["csv"], key="risk")

if uploaded_file:
    data = pd.read_csv(uploaded_file)
    expected_cols = ['gender', 'title', 'dept_name', 'tenure', 'amount', 'num_promotions']
    if all(col in data.columns for col in expected_cols):
        input_data = data[expected_cols]
        preds = model.predict(input_data)
        data['Predicted Risk'] = preds
        st.success("âœ… Predictions Done!")
        st.dataframe(data)
        csv = data.to_csv(index=False).encode('utf-8')
        st.download_button("â¬‡ï¸ Download Results as CSV", data=csv, file_name="risk_predictions.csv")
    else:
        st.error("âŒ CSV must include columns: " + ", ".join(expected_cols))

# --- Insights Section ---
st.header("ğŸ’¬ Ask a Question About HR Data")
question = st.text_input("Type your question below:")

# Add your logic here to respond to questions like in your previous script
# Example:
if question:
    q = question.lower()
    if "top salaries" in q:
        st.write("ğŸ“Œ Top 10 Highest Paid Employees Coming Soon...")
    else:
        st.warning("âš ï¸ Question not recognized. Try rephrasing.")

# --- Optional: Employee Salary Trend ---
st.header("ğŸ“ˆ Check Employee Salary Trend")
emp_id_input = st.text_input("Enter Employee ID:", key="salary")

if emp_id_input:
    try:
        emp_id = int(emp_id_input)
        salary['from_date'] = pd.to_datetime(salary['from_date'])
        emp_data = salary[salary['employee_id'] == emp_id]
        if not emp_data.empty:
            st.dataframe(emp_data)
            fig, ax = plt.subplots()
            ax.plot(emp_data['from_date'], emp_data['amount'], marker='o')
            ax.set_title(f"Salary Over Time for Employee {emp_id}")
            ax.set_xlabel("Date")
            ax.set_ylabel("Salary")
            ax.grid(True)
            st.pyplot(fig)
        else:
            st.warning("No salary data found for this employee.")
    except ValueError:
        st.warning("Please enter a valid numeric ID.")
