# -*- coding: utf-8 -*-
"""HR.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BRPDra8Zdc_vshxER2aey6dnJ-HG5b7a
"""
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from io import BytesIO

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
@st.cache_data
def load_data():
    employee = pd.read_csv("employee.csv")
    department = pd.read_csv("department.csv")
    salary = pd.read_csv("salary.csv")
    title = pd.read_csv("title.csv")
    return employee, department, salary, title

employee, department, salary, title = load_data()

# Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
df = employee.merge(department, on='dept_id', how='left')\
             .merge(salary, on='emp_id', how='left')\
             .merge(title, on='emp_id', how='left')

# ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
st.set_page_config(page_title="HR Analytics", layout="wide")

# CSS Ù„ØªØ¬Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
st.markdown("""
<style>
h1, h2, h3 {
    color: #0E4D92;
    text-align: center;
}
.stButton button {
    background-color: #0E4D92;
    color: white;
    font-weight: bold;
    border-radius: 10px;
}
input[type="text"] {
    border: 2px solid #0E4D92;
    border-radius: 8px;
}
.chart-container {
    text-align: center;
    padding: 10px;
}
.explanation {
    color: #333;
    font-size: 15px;
    text-align: center;
    margin-bottom: 30px;
}
</style>
""", unsafe_allow_html=True)

st.title("ğŸ“Š HR Analytics Dashboard")

# Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„
col1, col2 = st.columns([4, 1])
with col1:
    user_question = st.text_input("Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹)", key="input_text")
with col2:
    submit = st.button("âœ… Submit")
clear = st.button("ğŸ—‘ï¸ Clear")

if clear:
    st.experimental_rerun()

def download_button(fig, filename):
    buf = BytesIO()
    fig.savefig(buf, format="png")
    st.download_button("ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©", data=buf.getvalue(), file_name=filename, mime="image/png")

# Ø±Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
if submit and user_question:
    matched = False

    def show_chart(fig, explanation):
        st.pyplot(fig)
        st.markdown(f'<div class="explanation">{explanation}</div>', unsafe_allow_html=True)
        download_button(fig, "chart.png")

    # 1. ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    if "ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹" in user_question:
        matched = True
        fig, ax = plt.subplots()
        sns.countplot(data=df, x='gender', hue='job_title', ax=ax)
        ax.set_title("ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹")
        show_chart(fig, "ÙŠÙˆØ¶Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³Ù…ÙŠØ§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³.")

    # 2. Ø§Ù„ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
    elif "Ø§Ù„ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ©" in user_question:
        matched = True
        df['last_promotion_year'] = pd.to_datetime(df['last_promotion_date']).dt.year
        df['years_since_promotion'] = 2025 - df['last_promotion_year']
        avg_promotion = df.groupby('dept_name')['years_since_promotion'].mean().sort_values()
        fig, ax = plt.subplots()
        avg_promotion.plot(kind='barh', ax=ax, color='skyblue')
        ax.set_title("Ù…ØªÙˆØ³Ø· Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…")
        show_chart(fig, "ÙŠÙˆØ¶Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„ØªÙŠ Ù…Ø±Øª Ù…Ù†Ø° Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ ÙƒÙ„ Ù‚Ø³Ù….")

    # 3. Ø§Ù„ÙØ¬ÙˆØ© ÙÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†Ø³ÙŠÙ†
    elif "Ø§Ù„ÙØ¬ÙˆØ© ÙÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨" in user_question or "Ø§Ù„Ø±Ø§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³" in user_question:
        matched = True
        avg_salary = df.groupby('gender')['salary'].mean()
        fig, ax = plt.subplots()
        avg_salary.plot(kind='bar', color=['#FF69B4', '#00BFFF'], ax=ax)
        ax.set_title("Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³")
        show_chart(fig, "ÙŠÙˆØ¶Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… Ø§Ù„ÙØ¬ÙˆØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨ÙŠÙ† Ø§Ù„Ø°ÙƒÙˆØ± ÙˆØ§Ù„Ø¥Ù†Ø§Ø«.")

    # 4. Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    elif "Ø§Ø³ØªÙ‚Ø±Ø§Ø±" in user_question or "Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" in user_question:
        matched = True
        df['tenure'] = pd.to_datetime(df['exit_date'].fillna('2025'))\
                        .dt.year - pd.to_datetime(df['hire_date']).dt.year
        avg_tenure = df.groupby('dept_name')['tenure'].mean().sort_values()
        fig, ax = plt.subplots()
        avg_tenure.plot(kind='barh', ax=ax, color='lightgreen')
        ax.set_title("Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ ÙƒÙ„ Ù‚Ø³Ù…")
        show_chart(fig, "ÙŠÙˆØ¶Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… Ù…Ø¯Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¯Ø§Ø®Ù„ ÙƒÙ„ Ù‚Ø³Ù….")

    # 5. Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    elif "Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹" in user_question or "Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø°ÙƒÙˆØ± ÙˆØ§Ù„Ø¥Ù†Ø§Ø«" in user_question:
        matched = True
        df['was_promoted'] = df['last_promotion_date'].notna()
        promotions_by_gender = df.groupby('gender')['was_promoted'].mean()
        fig, ax = plt.subplots()
        promotions_by_gender.plot(kind='bar', color=['#FF69B4', '#00BFFF'], ax=ax)
        ax.set_title("Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹")
        show_chart(fig, "ÙŠÙˆØ¶Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªÙØ§ÙˆØª ÙÙŠ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø°ÙƒÙˆØ± ÙˆØ§Ù„Ø¥Ù†Ø§Ø«.")

    # 6. Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    elif "Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…" in user_question or "Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…" in user_question:
        matched = True
        avg_salary_dept = df.groupby('dept_name')['salary'].mean().sort_values()
        fig, ax = plt.subplots()
        avg_salary_dept.plot(kind='barh', ax=ax, color='orange')
        ax.set_title("Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…")
        show_chart(fig, "ÙŠÙˆØ¶Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø³Ù… Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.")

    if not matched:
        st.warning("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø©.")

